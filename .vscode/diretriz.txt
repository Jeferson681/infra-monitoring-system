Diretriz UNIVERSAL em 5 estágios — aplicável a qualquer módulo

Objetivo
- Fornecer um roteiro curto e obrigatório que o agente seguirá ao receber: "Padronize este módulo de acordo com Diretriz.txt".
- Garantir que nenhum ponto seja esquecido (idioma, blocos, docstrings, excepts, logs, helpers, compatibilidade de API, validação).

Regra global rápida
- Código (identifiers): inglês.
- Docstrings, comentários curtos, console, debug e logs human-readable: português.
- Logs estruturados/fields JSON e nomes técnicos internos: inglês.

Aplicação automática: siga estes 5 estágios em ordem para qualquer arquivo

Stage A — Scan inicial e contrato
- Ação: gerar um relatório curto do arquivo alvo com: strings de logger, `except Exception` / `except:`, funções/classes sem docstring pública, ausência de blocos numerados, usos de termos em inglês nas mensagens humanas.
- Saída esperada: lista de pontos a corrigir (usada como checklist).

Stage B — Idioma e mensagens humanas
- Ação: garantir que todas mensagens humanas (logger.info/warning/error/debug que não sejam fields JSON) e prints estejam em português.
- Regra: manter termos técnicos e keys JSON em inglês (p.ex. `thresholds`) — opcionalmente entre parênteses usar PT.
- Nota: não alterar conteúdo de logs estruturados (jsonl) sem garantir compatibilidade com consumidores.

Stage C — Estrutura do arquivo e API compatibility
+- Ação: garantir blocos numerados no topo (mínimo: 0. Config, 1. Paths/I/O, 2. Helpers/Funções). Ajustar helpers locais conforme diretriz.
+- Regra explícita: helpers relacionados diretamente à função principal do módulo devem ser posicionados logo abaixo dessa função (ex.: helpers de `load_settings` imediatamente após `load_settings`). Helpers reutilizáveis continuam em `src/system/helpers.py` ou `src/system/log_helpers.py`.
+- Crucial: NÃO alterar a API pública do módulo sem compatibilidade reversa. Se for necessário renomear, adicionar alias compatível (mantendo comportamento) e documentar.
+- Adicionar `# noqa` temporário apenas com TODO e justificativa se não for possível completar sem testes.

Stage D — Robustez: exceções e validações
- Ação: remover `except:` e `except Exception:` amplos; substituir por exceções específicas (OSError, PermissionError, ValueError, TypeError, ImportError) e logar motivo em PT.
- Em casos de fallback intencional, adicionar comentário `# fallback: motivo` e log em PT.

Stage E — Docstrings, helpers, logs e validação final
- Ação: reintroduzir docstrings públicas em PT (1–2 linhas), posicionar helpers (exclusivos junto à função; reutilizáveis em `system/helpers.py`), garantir human logs em PT e JSON fields em EN.
- Verificação: rodar `ruff check` no arquivo, e `pytest` para testes relacionados (se existirem). Corrigir avisos ou adicionar `# noqa` com TODOs claros.

Processo operacional (1 arquivo por vez)
1. Execute Stage A e confirme a lista de problemas.
2. Aplique mudanças Stage B → revalide (ruff).
3. Aplique Stage C (estrutura e compatibilidade) → revalide.
4. Aplique Stage D (excepts) → revalide.
5. Aplique Stage E (docstrings/helpers/logs) → validação final (ruff + pytest).
6. Commit atômico: `style: padroniza <arquivo> — stages A..E`.

Comandos de suporte (PowerShell)
```powershell
& .\.venv\Scripts\Activate.ps1;
# Stage A scans
select-string -Path src\**\*.py -Pattern 'except Exception|except:' -CaseSensitive | Out-File scan_excepts.txt
select-string -Path src\**\*.py -Pattern 'logger\.(debug|info|warning|error)\(|print\(' | Out-File scan_logger.txt
& .\.venv\Scripts\Activate.ps1; ruff check src/path/to/file.py
```

Checklist UNIVERSAL por arquivo (marcar cada item ao aplicar)
+- [ ] Stage A: lista de problemas gerada
+- [ ] Stage B: todas mensagens humanas e debug em PT (JSON fields preservados)
+- [ ] Stage C: blocos 0/1/2 presentes; helpers relacionados posicionados imediatamente abaixo da função principal; helpers reutilizáveis em `src/system/*`; nenhuma mudança breaking na API (ou alias documentado)
+- [ ] Stage D: `except` genérico removido ou substituído por tipos específicos; `# fallback` documentado onde aplicável
+- [ ] Stage E: docstrings públicas em PT (1–2 linhas) ou `# noqa` com TODO; ruff/pytest passam ou `noqa` documentado
+- [ ] Commit: mensagem padronizada e descrição curta das alterações e TODOs pendentes

Regras adicionais de compatibilidade
- Nunca remover silently um nome público (função/classe) — se renomear, mantenha alias:
  def old_name(...):
      return new_name(...)
  # TODO: remover old_name após X
- Para alterações que podem afetar consumidores externos, criar teste de integração mínimo.

Política `noqa` e TODOs
- `# noqa` permitido apenas com comentário TODO com data/razão e responsável.
- Registrar todos `noqa` num arquivo `MAINTAINER_TODO.md` na raiz (apêndice automático recomendado).

Fim da Diretriz UNIVERSAL (5 estágios).

Seção Didática e Legibilidade (para portfólio)
- Objetivo: tornar módulos fáceis de entender por iniciantes e recrutadores.
- Inserir no topo do arquivo (após blocos 0/1): um cabeçalho curto com 1–2 linhas que descrevem o propósito do módulo em PT.

Templates práticos (copiar/colar)
- Arquivo header (após blocos):
  # --- Module purpose
  # Este módulo: coleta e normaliza configurações (exemplo). Escreva 1 linha curta em PT.

- Docstring curta (função pública):
  """Retorna thresholds validados.

  Retorna dicionário com chaves 'cpu_percent', 'memory_percent', etc.
  """

- Helper positioning example:
  def load_settings():
      ...

  # helper específico de load_settings
  def _read_env_file(...):
      ...

- Commit message template:
  style: padroniza <module/path.py> — stages A..E
  breve: lista curto de mudanças (idioma, excepts, docstrings)

Checklist adicional para legibilidade
- [ ] Topo do arquivo tem 1 linha resumo em PT
- [ ] Funções públicas têm docstring curta em PT
- [ ] Helpers específicos estão imediatamente abaixo da função principal
- [ ] Mensagens humanas (logs) são claras e concisas em PT (sem jargões desnecessários)

Fim da seção didática.
